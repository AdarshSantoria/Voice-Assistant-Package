{"version":3,"names":["_reactNative","require","_defineProperty","e","r","t","_toPropertyKey","Object","defineProperty","value","enumerable","configurable","writable","i","_toPrimitive","Symbol","toPrimitive","call","TypeError","String","Number","LINKING_ERROR","Platform","select","ios","default","LivekitReactNative","NativeModules","Proxy","get","Error","AndroidAudioTypePresets","exports","communication","manageAudioFocus","audioMode","audioFocusMode","audioStreamType","audioAttributesUsageType","audioAttributesContentType","media","getDefaultAppleAudioConfigurationForMode","mode","preferSpeakerOutput","audioCategory","audioCategoryOptions","AudioSession","config","configureAudio","startAudioSession","stopAudioSession","OS","getAudioOutputs","deviceId","selectAudioOutput","showAudioRoutePicker","setAppleAudioConfiguration"],"sources":["AudioSession.ts"],"sourcesContent":["import { NativeModules, Platform } from 'react-native';\nconst LINKING_ERROR =\n  `The package '@livekit/react-native' doesn't seem to be linked. Make sure: \\n\\n` +\n  Platform.select({ ios: \"- You have run 'pod install'\\n\", default: '' }) +\n  '- You rebuilt the app after installing the package\\n' +\n  '- You are not using Expo managed workflow\\n';\n\nconst LivekitReactNative = NativeModules.LivekitReactNative\n  ? NativeModules.LivekitReactNative\n  : new Proxy(\n      {},\n      {\n        get() {\n          throw new Error(LINKING_ERROR);\n        },\n      }\n    );\n\n/**\n * Configuration for the underlying AudioSession.\n *\n * ----\n * Android specific options:\n *\n * * preferredOutputList - The preferred order in which to automatically select an audio output.\n *   This is ignored when an output is manually selected with {@link AudioSession.selectAudioOutput}.\n *\n *   By default, the order is set to:\n *   1. `\"bluetooth\"\n *   2. `\"headset\"``\n *   3. `\"speaker\"`\n *   4. `\"earpiece\"`\n *\n * * audioTypeOptions - An {@link AndroidAudioTypeOptions} object which provides the\n *   audio options to use on Android.\n *\n *   See {@link AndroidAudioTypePresets} for pre-configured values.\n *\n * ----\n * iOS\n *\n * * defaultOutput - The default preferred output to use when a wired headset or bluetooth output is unavailable.\n *\n *   By default, this is set to `\"speaker\"`\n */\nexport type AudioConfiguration = {\n  android?: {\n    preferredOutputList?: ('speaker' | 'earpiece' | 'headset' | 'bluetooth')[];\n    audioTypeOptions: AndroidAudioTypeOptions;\n  };\n  ios?: {\n    defaultOutput?: 'speaker' | 'earpiece';\n  };\n};\n\nexport type AndroidAudioTypeOptions = {\n  /**\n   * Whether LiveKit should handle managing the audio focus or not.\n   *\n   * Defaults to true.\n   */\n  manageAudioFocus?: boolean;\n\n  /**\n   * Corresponds to {@link https://developer.android.com/reference/android/media/AudioManager#setMode(int)}\n   *\n   * Defaults to 'inCommunication'.\n   */\n  audioMode?:\n    | 'normal'\n    | 'callScreening'\n    | 'inCall'\n    | 'inCommunication'\n    | 'ringtone';\n\n  /**\n   * Corresponds to the duration hint when requesting audio focus.\n   *\n   * Defaults to 'gain'.\n   *\n   * See also {@link https://developer.android.com/reference/android/media/AudioManager#AUDIOFOCUS_GAIN}\n   */\n  audioFocusMode?:\n    | 'gain'\n    | 'gainTransient'\n    | 'gainTransientExclusive'\n    | 'gainTransientMayDuck';\n\n  /**\n   * Corresponds to Android's AudioAttributes usage type.\n   *\n   * Defaults to 'voiceCommunication'.\n   *\n   * See also {@link https://developer.android.com/reference/android/media/AudioAttributes}\n   */\n  audioAttributesUsageType?:\n    | 'alarm'\n    | 'assistanceAccessibility'\n    | 'assistanceNavigationGuidance'\n    | 'assistanceSonification'\n    | 'assistant'\n    | 'game'\n    | 'media'\n    | 'notification'\n    | 'notificationEvent'\n    | 'notificationRingtone'\n    | 'unknown'\n    | 'voiceCommunication'\n    | 'voiceCommunicationSignalling';\n\n  /**\n   * Corresponds to Android's AndroidAttributes content type.\n   *\n   * Defaults to 'speech'.\n   *\n   * See also {@link https://developer.android.com/reference/android/media/AudioAttributes}\n   */\n  audioAttributesContentType?:\n    | 'movie'\n    | 'music'\n    | 'sonification'\n    | 'speech'\n    | 'unknown';\n\n  /**\n   * Corresponds to the stream type when requesting audio focus. Used on pre-O devices.\n   *\n   * Defaults to 'voiceCall'\n   *\n   * See also {@link https://developer.android.com/reference/android/media/AudioManager#STREAM_VOICE_CALL}\n   */\n  audioStreamType?:\n    | 'accessibility'\n    | 'alarm'\n    | 'dtmf'\n    | 'music'\n    | 'notification'\n    | 'ring'\n    | 'system'\n    | 'voiceCall';\n\n  /**\n   * On certain Android devices, audio routing does not function properly and\n   * bluetooth microphones will not work unless audio mode is set to\n   * `inCommunication` or `inCall`. Audio routing is turned off those cases.\n   *\n   * If this set to true, will attempt to do audio routing regardless of audio mode.\n   *\n   * Defaults to false.\n   */\n  forceHandleAudioRouting?: boolean;\n};\n\nexport const AndroidAudioTypePresets: {\n  /**\n   * A pre-configured AndroidAudioConfiguration for voice communication.\n   */\n  communication: AndroidAudioTypeOptions;\n  /**\n   * A pre-configured AndroidAudioConfiguration for media playback.\n   */\n  media: AndroidAudioTypeOptions;\n} = {\n  communication: {\n    manageAudioFocus: true,\n    audioMode: 'inCommunication',\n    audioFocusMode: 'gain',\n    audioStreamType: 'voiceCall',\n    audioAttributesUsageType: 'voiceCommunication',\n    audioAttributesContentType: 'speech',\n  },\n  media: {\n    manageAudioFocus: true,\n    audioMode: 'normal',\n    audioFocusMode: 'gain',\n    audioStreamType: 'music',\n    audioAttributesUsageType: 'media',\n    audioAttributesContentType: 'unknown',\n  },\n} as const;\n\nexport type AppleAudioMode =\n  | 'default'\n  | 'gameChat'\n  | 'measurement'\n  | 'moviePlayback'\n  | 'spokenAudio'\n  | 'videoChat'\n  | 'videoRecording'\n  | 'voiceChat'\n  | 'voicePrompt';\n\nexport type AppleAudioCategory =\n  | 'soloAmbient'\n  | 'playback'\n  | 'record'\n  | 'playAndRecord'\n  | 'multiRoute';\n\nexport type AppleAudioCategoryOption =\n  | 'mixWithOthers'\n  | 'duckOthers'\n  | 'interruptSpokenAudioAndMixWithOthers'\n  | 'allowBluetooth'\n  | 'allowBluetoothA2DP'\n  | 'allowAirPlay'\n  | 'defaultToSpeaker';\n\nexport type AppleAudioConfiguration = {\n  audioCategory?: AppleAudioCategory;\n  audioCategoryOptions?: AppleAudioCategoryOption[];\n  audioMode?: AppleAudioMode;\n};\n\nexport type AudioTrackState =\n  | 'none'\n  | 'remoteOnly'\n  | 'localOnly'\n  | 'localAndRemote';\n\nexport function getDefaultAppleAudioConfigurationForMode(\n  mode: AudioTrackState,\n  preferSpeakerOutput: boolean = true\n): AppleAudioConfiguration {\n  if (mode === 'remoteOnly') {\n    return {\n      audioCategory: 'playback',\n      audioCategoryOptions: ['mixWithOthers'],\n      audioMode: 'spokenAudio',\n    };\n  } else if (mode === 'localAndRemote' || mode === 'localOnly') {\n    return {\n      audioCategory: 'playAndRecord',\n      audioCategoryOptions: ['allowBluetooth', 'mixWithOthers'],\n      audioMode: preferSpeakerOutput ? 'videoChat' : 'voiceChat',\n    };\n  }\n\n  return {\n    audioCategory: 'soloAmbient',\n    audioCategoryOptions: [],\n    audioMode: 'default',\n  };\n}\n\nexport default class AudioSession {\n  /**\n   * Applies the provided audio configuration to the underlying AudioSession.\n   *\n   * Must be called prior to connecting to a Room for the configuration to apply correctly.\n   *\n   * See also useIOSAudioManagement for automatic configuration of iOS audio options.\n   */\n  static configureAudio = async (config: AudioConfiguration) => {\n    await LivekitReactNative.configureAudio(config);\n  };\n\n  /**\n   * Starts an AudioSession.\n   */\n  static startAudioSession = async () => {\n    await LivekitReactNative.startAudioSession();\n  };\n\n  /**\n   * Stops the existing AudioSession.\n   */\n  static stopAudioSession = async () => {\n    await LivekitReactNative.stopAudioSession();\n  };\n\n  /**\n   * Gets the available audio outputs for use with {@link selectAudioOutput}.\n   *\n   * {@link startAudioSession} must be called prior to using this method.\n   *\n   * For Android, will return if available:\n   * * \"speaker\"\n   * * \"earpiece\"\n   * * \"headset\"\n   * * \"bluetooth\"\n   *\n   * ----\n   *\n   * For iOS, due to OS limitations, the only available types are:\n   * * \"default\" - Use default iOS audio routing\n   * * \"force_speaker\" - Force audio output through speaker\n   *\n   * See also {@link showAudioRoutePicker} to display a route picker that\n   * can choose between other audio devices (i.e. headset/bluetooth/airplay),\n   * or use a library like `react-native-avroutepicker` for a native platform\n   * control.\n   *\n   * @returns the available audio output types\n   */\n  static getAudioOutputs = async (): Promise<string[]> => {\n    if (Platform.OS === 'ios') {\n      return ['default', 'force_speaker'];\n    } else if (Platform.OS === 'android') {\n      return (await LivekitReactNative.getAudioOutputs()) as string[];\n    } else {\n      return [];\n    }\n  };\n\n  /**\n   * Select the provided audio output if available.\n   *\n   * {@link startAudioSession} must be called prior to using this method.\n   *\n   * @param deviceId A deviceId retrieved from {@link getAudioOutputs}\n   */\n  static selectAudioOutput = async (deviceId: string) => {\n    await LivekitReactNative.selectAudioOutput(deviceId);\n  };\n\n  /**\n   * iOS only, requires iOS 11+.\n   *\n   * Displays an AVRoutePickerView for the user to choose their audio output.\n   */\n  static showAudioRoutePicker = async () => {\n    if (Platform.OS === 'ios') {\n      await LivekitReactNative.showAudioRoutePicker();\n    }\n  };\n\n  /**\n   * Directly change the AVAudioSession category/mode.\n   *\n   * @param config The configuration to use. Null values will be omitted and the\n   * existing values will be unchanged.\n   */\n  static setAppleAudioConfiguration = async (\n    config: AppleAudioConfiguration\n  ) => {\n    if (Platform.OS === 'ios') {\n      await LivekitReactNative.setAppleAudioConfiguration(config);\n    }\n  };\n}\n"],"mappings":"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","ignoreList":[]}